echo
echo HACKBENCH SOCKETS
gendirlist hackbench-sockets
THREADS=`ls hackbench-sockets-$KERNEL_BASE/$TOPLEVEL/hackbench.* | sed -e 's/.*hackbench.//' | sort -n`

echo -n > hackbench-sockets-$KERNEL_BASE/$TOPLEVEL/hackbench-results
for DIR in $DIRLIST; do
	echo -n > $DIR/$TOPLEVEL/hackbench-results
	echo -n > $DIR/$TOPLEVEL/hackbench-ratio
done
for THREAD in $THREADS; do
	printf "%12d" $THREAD
	VANILLA=`cat hackbench-sockets-$KERNEL_BASE/$TOPLEVEL/hackbench.$THREAD | grep Time: | awk '{print $2}' | check-confidence.pl --confidence-level 99 --limit 1 --print-mean`

	if [ "$VANILLA" = "" ]; then
		VANILLA=`cat hackbench-sockets-$KERNEL_BASE/$TOPLEVEL/hackbench.$THREAD | grep Time: | awk '{print $2}' | mean`
	fi
	echo $THREAD $VANILLA >> hackbench-sockets-$KERNEL_BASE/$TOPLEVEL/hackbench-results
	for DIR in $DIRLIST; do
		RESULT=`cat $DIR/$TOPLEVEL/hackbench.$THREAD | grep Time: | awk '{print $2}' | check-confidence.pl --confidence-level 99 --limit 1 --print-mean`
		if [ "$RESULT" = "" ]; then
			RESULT=`cat $DIR/$TOPLEVEL/hackbench.$THREAD | grep Time: | awk '{print $2}' | mean`
		fi
		echo $THREAD $RESULT >> $DIR/$TOPLEVEL/hackbench-results
		echo $THREAD `rdiff $RESULT $VANILLA` >> $DIR/$TOPLEVEL/hackbench-ratio
		printf " %8.4f (%5.4f%%)" $RESULT `pndiff $RESULT $VANILLA`
	done
	echo
done

INPUTS=
for DIR in $DIRLIST; do
	INPUTS="$INPUTS `pwd`/$DIR/$TOPLEVEL/hackbench-results"
	TITLES="$TITLES `echo $DIR | sed -e 's/hackbench-sockets-//'`"
done
