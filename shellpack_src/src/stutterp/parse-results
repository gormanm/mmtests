#!/bin/bash
SHELLPACK_ROOT=$(dirname $(realpath -s ${BASH_SOURCE[0]}))
SHELLPACK_BIN=$SHELLPACK_ROOT/../../bin/

LOGDIR=${1:-`pwd`}
cd $LOGDIR || exit 1

for FACTORA in `ls mmap-latency-*.log.gz | awk -F - '{print $3}' | sed -e 's/.log.gz//'`; do
	NR_SAMPLES=0
	while read NR_MEASUREMENTS LATENCY; do
		while [ $NR_MEASUREMENTS -gt 0 ]; do
			((NR_SAMPLES++))
			((NR_MEASUREMENTS--))
			echo -e "mmap\t$FACTORA\t_\t$NR_SAMPLES\t$((LATENCY/1000))\t_"
		done
	done <<< $(zcat mmap-latency-$FACTORA.log.gz)
done | sort -k1,1 -k2,2n -k4,4n
