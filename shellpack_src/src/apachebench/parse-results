#!/bin/bash
SHELLPACK_ROOT=$(dirname $(realpath -s ${BASH_SOURCE[0]}))

LOGDIR=${1:-`pwd`}
cd $LOGDIR || exit 1

# Required output format, tab delimited
# - metric factorA factorB interval value extra
# Where;
# metric:	A primary metric like time, a specific operation e.g. Latency, Elapsed, transaction
# factorA:	Statistically relevant modifier such as percentile, thread count, worker etc
# factorB:	Secondary factor
# interval:	e.g. time elapsed, iteration etc
# value:	the benchmark measurement
# extra:	Optional value, currently used to identify a metric+factor for dashboard comparisons
for CLIENTS in `ls apachebench*.log | sed -e 's/\.log$//' | cut -d- -f2 | sort -u -n`; do
	for ITERATION in `\ls apachebench-$CLIENTS-*.log | sed -e 's/\.log$//' | cut -d- -f3 | sort -n`; do
		grep "Time per request" apachebench-$CLIENTS-$ITERATION.log | head -1 | awk "{print \"mean-request\t$CLIENTS\t_\t\"$ITERATION\"\t\"\$4\"\t_\"}"
	done
done
