### schbench is a latency measurement benchmark that uses a mix of worker and
### messaging threads. The worker threads wait for messages to come in which
### include a timestamp of when they were queued and records how long it took
### to receive the message. The message threads send messages and sleep for
### a small random amount of time in between. The benchmark reports quartiles
### of wakeup times of the worker threads with a specific interest in the
### worse-case outliers.
###
### This configuration uses the default schbench configuration of 1 message
### thread and NUMCPUS worker threads per message thread.
###

export MMTESTS="schbench"

# List of monitors
export RUN_MONITOR=yes
export MONITORS_ALWAYS=
export MONITORS_GZIP="proc-vmstat mpstat turbostat"
export MONITORS_WITH_LATENCY="vmstat"
export MONITOR_UPDATE_FREQUENCY=3

# schbench
export SCHBENCH_RUNTIME=180
export SCHBENCH_INTERVAL=10
export SCHBENCH_MESSAGE_THREADS=$NUMNODES
export SCHBENCH_MIN_WORKER_THREADS=$((NUMCPUS/NUMNODES))
export SCHBENCH_MAX_WORKER_THREADS=$((NUMCPUS/NUMNODES))

if [ $NUMNODES -eq 1 ]; then
        echo Skipping NUMA test configuration on single node machine
        exit $SHELLPACK_SUCCESS
fi
